<div class="dm-dashboard">
    <!-- Header with DM tools navigation -->
    <div class="dm-header">
        <div class="dm-title-container">
            <h1 class="dm-title">{{ 'dm-dashboard' | transloco }}</h1>
        </div>

        <div class="dm-tabs">
            <button class="dm-tab" [class.active]="currentTab === 'enemies'" (click)="switchTab('enemies')">{{ 'enemies' | transloco }}</button>
            <button class="dm-tab" [class.active]="currentTab === 'npcs'" (click)="switchTab('npcs')">{{ 'npcs' | transloco }}</button>
            <button class="dm-tab" [class.active]="currentTab === 'quests'" (click)="switchTab('quests')">{{ 'quests' | transloco }}</button>
            <button class="dm-tab" [class.active]="currentTab === 'items'" (click)="switchTab('items')">{{ 'items' | transloco }}</button>
        </div>
    </div>

    <!-- Main content area -->
    <div class="dm-content">
        <!-- Enemies Section - only visible when enemies tab is active -->
        <ng-container *ngIf="currentTab === 'enemies'">
        <!-- Battle preparation panel -->
        <div class="battle-panel">
            <div class="battle-header">
                <h2 class="battle-title">{{ 'battle-preparation' | transloco }}</h2>
                <div class="battle-actions">
                    <button class="battle-button" [disabled]="enemiesListToStartBattle.length === 0"
                        (click)="startBattle()">
                        <span class="battle-icon">‚öîÔ∏è</span>
                        {{ 'begin-battle' | transloco }}
                    </button>
                    <button class="battle-button secondary" [disabled]="enemiesListToStartBattle.length === 0"
                        (click)="clearBattleList()">
                        {{ 'clear-all' | transloco }}
                    </button>
                </div>
            </div>

            <div class="battle-enemies">
                @if (enemiesListToStartBattle.length > 0) {
                <div class="selected-enemies-list">
                    @for (enemy of enemiesListToStartBattle; track $index) {
                    <div class="selected-enemy-item">
                        <div class="enemy-avatar" [style.backgroundImage]="'url(' + enemy.image_url + ')'">
                            <div class="enemy-level">{{ enemy.level }}</div>
                        </div>
                        <div class="enemy-details">
                            <div class="enemy-name">{{ enemy.name }}</div>
                            <div class="enemy-stats">HP: {{ enemy.current_hp }}</div>
                        </div>
                        <button class="remove-enemy" (click)="removeEnemyFromBattle(enemy)">
                            <span>√ó</span>
                        </button>
                    </div>
                    }
                </div>
                } @else {
                <div class="empty-battle-list">
                    <div class="empty-icon">üõ°Ô∏è</div>
                    <p>{{ 'no-enemies-selected' | transloco }}</p>
                    <p class="empty-hint">{{ 'select-enemies-below' | transloco }}</p>
                </div>
                }
            </div>
        </div>

        <!-- Enemy library section -->
        <div class="enemies-library">
            <div class="library-header">
                <h2 class="library-title">{{ 'enemy-library' | transloco }}</h2>
                <div class="library-actions">
                    <button class="library-button" (click)="openCreateEnemyDialog()">
                        <span class="add-icon">+</span>
                        {{ 'create-enemy' | transloco }}
                    </button>
                    <div class="search-container">
                        <input type="text" class="search-input" placeholder="{{ 'search-enemies' | transloco }}"
                            [(ngModel)]="searchTerm">
                    </div>
                </div>
            </div>

            <div class="enemies-grid">
                @if (enemiesList && enemiesList.length > 0) {
                @for (enemy of filteredEnemies; track $index) {
                <div class="enemy-card">
                    <div class="enemy-card-header">
                        <h3 class="enemy-card-title">{{ enemy.name }}</h3>
                        <div class="enemy-card-level">{{ 'level' | transloco }} {{ enemy.level }}</div>
                    </div>

                    <div class="enemy-card-image" [style.backgroundImage]="'url(' + enemy.image_url + ')'">
                        <div class="enemy-card-overlay"></div>
                    </div>

                    <div class="enemy-card-content">
                        <p class="enemy-card-description">{{ enemy.description }}</p>

                        <div class="enemy-card-stats">
                            <div class="stat-item">
                                <span class="stat-icon">‚ù§Ô∏è</span>
                                <span class="stat-value">{{ enemy.total_hp || 100 }}</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-icon">‚öîÔ∏è</span>
                                <span class="stat-value">10</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-icon">üõ°Ô∏è</span>
                                <span class="stat-value">{{ enemy.defense || 5 }}</span>
                            </div>
                        </div>
                    </div>

                    <div class="enemy-card-actions">
                        <button class="enemy-action-button primary" (click)="addEnemyToBattle(enemy)">
                            {{ 'add-to-battle' | transloco }}
                        </button>
                        <button class="enemy-action-button" (click)="editEnemy(enemy)">
                            {{ 'edit' | transloco }}
                        </button>
                        <button class="enemy-action-button danger" (click)="deleteEnemy(enemy)">
                            {{ 'delete' | transloco }}
                        </button>
                    </div>
                </div>
                }
                } @else {
                <div class="empty-enemies-list">
                    <div class="empty-icon">üêâ</div>
                    <p>{{ 'no-enemies-available' | transloco }}</p>
                    <button class="create-first-enemy" (click)="openCreateEnemyDialog()">
                        {{ 'create-first-enemy' | transloco }}
                    </button>
                </div>
                }
            </div>
        </div>
        </ng-container>
        
        <!-- NPCs Section - only visible when npcs tab is active -->
        <ng-container *ngIf="currentTab === 'npcs'">
            <div class="npcs-library">
                <div class="library-header">
                    <h2 class="library-title">{{ 'npc-library' | transloco }}</h2>
                    <div class="library-actions">
                        <button class="library-button" (click)="createNPC()">
                            <span class="add-icon">+</span>
                            {{ 'create-npc' | transloco }}
                        </button>
                        <div class="search-container">
                            <input type="text" class="search-input" placeholder="{{ 'search-npcs' | transloco }}"
                                [(ngModel)]="searchTermNPCs">
                        </div>
                    </div>
                </div>

                <div class="enemies-grid">
                    @if (filteredNPCs.length > 0) {
                    @for (npc of filteredNPCs; track npc.id) {
                    <div class="enemy-card">
                        <div class="enemy-card-header">
                            <h3 class="enemy-card-title">{{ npc.name }}</h3>
                        </div>

                        <div class="enemy-card-image" [style.backgroundImage]="'url(' + npc.img_url + ')'">
                            <div class="enemy-card-overlay"></div>
                        </div>

                        <div class="enemy-card-content">
                            <div class="enemy-card-stats">
                                @if (npc.description) {
                                    <div class="stat-item">
                                        <span>{{ npc.description }}</span>
                                    </div>
                                }
                            </div>
                        </div>

                        <div class="enemy-card-actions">
                            <button class="enemy-action-button" (click)="editNPC(npc)">
                                {{ 'edit' | transloco }}
                            </button>
                            <button class="enemy-action-button danger" (click)="deleteNPC(npc)">
                                {{ 'delete' | transloco }}
                            </button>
                        </div>
                    </div>
                    }
                    } @else {
                    <div class="empty-enemies-list">
                        <div class="empty-icon">üë§</div>
                        <p>{{ 'no-npcs-available' | transloco }}</p>
                        <button class="create-first-enemy" (click)="createNPC()">
                            {{ 'create-first-npc' | transloco }}
                        </button>
                    </div>
                    }
                </div>
            </div>
        </ng-container>
    </div>

    <!-- Footer with settings and user options -->
    <div class="dm-footer">
        <app-locale-changer></app-locale-changer>
        <button class="enemy-action-button danger" (click)="signOut()">
            {{ 'sign-out' | transloco }}
        </button>
    </div>
</div>