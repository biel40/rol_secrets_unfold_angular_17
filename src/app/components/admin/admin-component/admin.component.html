<div class="dm-dashboard">
    <!-- Header with DM tools navigation -->
    <div class="dm-header">
        <div class="dm-title-container">
            <h1 class="dm-title">{{ 'dm-dashboard' | transloco }}</h1>
        </div>

        <div class="dm-tabs">
            <button class="dm-tab" [class.active]="currentTab === 'enemies'" (click)="switchTab('enemies')">{{ 'enemies'
                | transloco }}</button>
            <button class="dm-tab" [class.active]="currentTab === 'npcs'" (click)="switchTab('npcs')">{{ 'npcs' |
                transloco }}</button>
            <button class="dm-tab" [class.active]="currentTab === 'quests'" (click)="switchTab('quests')">{{ 'quests' |
                transloco }}</button>
            <button class="dm-tab" [class.active]="currentTab === 'users'" (click)="switchTab('users')">{{ 'users' |
                transloco }}</button>
            <button class="dm-tab" [class.active]="currentTab === 'habilities'" (click)="switchTab('habilities')">{{
                'habilities'
                | transloco }}</button>
        </div>
    </div>

    <div class="dm-content">
        <!-- Enemies Section - only visible when enemies tab is active -->
        <ng-container *ngIf="currentTab === 'enemies'">
            <div class="battle-panel">
                <div class="battle-header">
                    <h2 class="battle-title">{{ 'battle-preparation' | transloco }}</h2>
                    <div class="battle-actions">
                        <button class="battle-button" [disabled]="enemiesListToStartBattle.length === 0"
                            (click)="startBattle()">
                            <span class="battle-icon">‚öîÔ∏è</span>
                            {{ 'begin-battle' | transloco }}
                        </button>
                        <button class="battle-button secondary" [disabled]="enemiesListToStartBattle.length === 0"
                            (click)="clearBattleList()">
                            {{ 'clear-all' | transloco }}
                        </button>
                    </div>
                </div>

                <div class="battle-enemies">
                    @if (enemiesListToStartBattle.length > 0) {
                    <div class="selected-enemies-list">
                        @for (enemy of enemiesListToStartBattle; track $index) {
                        <div class="selected-enemy-item">
                            <div class="enemy-avatar" [style.backgroundImage]="'url(' + enemy.image_url + ')'">
                                <div class="enemy-level">{{ enemy.level }}</div>
                            </div>
                            <div class="enemy-details">
                                <div class="enemy-name">{{ enemy.name }}</div>
                                <div class="enemy-stats">HP: {{ enemy.current_hp }}</div>
                            </div>
                            <button class="remove-enemy" (click)="removeEnemyFromBattle(enemy)">
                                <span>√ó</span>
                            </button>
                        </div>
                        }
                    </div>
                    } @else {
                    <div class="empty-battle-list">
                        <div class="empty-icon">üõ°Ô∏è</div>
                        <p>{{ 'no-enemies-selected' | transloco }}</p>
                        <p class="empty-hint">{{ 'select-enemies-below' | transloco }}</p>
                    </div>
                    }
                </div>
            </div>

            <!-- Enemy library section -->
            <div class="enemies-library">
                <div class="library-header">
                    <h2 class="library-title">{{ 'enemy-library' | transloco }}</h2>
                    <div class="library-actions">
                        <button class="library-button" (click)="openCreateEnemyDialog()">
                            <span class="add-icon">+</span>
                            {{ 'create-enemy' | transloco }}
                        </button>

                        <div class="filter-container">
                            <select class="level-filter" [(ngModel)]="selectedLevelFilter">
                                <option value="">{{ 'all-levels' | transloco }}</option>
                                <option *ngFor="let levelRange of availableLevelRanges" [value]="levelRange.value">
                                    {{ levelRange.label }}
                                </option>
                            </select>
                        </div>

                        <div class="filter-container">
                            <select class="boss-filter" [(ngModel)]="selectedBossFilter">
                                <option value="">{{ 'all-enemy-types' | transloco }}</option>
                                <option *ngFor="let bossOption of bossFilterOptions" [value]="bossOption.value">
                                    {{ bossOption.label }}
                                </option>
                            </select>
                        </div>

                        <div class="search-container">
                            <input type="text" class="search-input" placeholder="{{ 'search-enemies' | transloco }}"
                                [(ngModel)]="searchTerm">
                        </div>

                        <button class="clear-filters-button" (click)="clearEnemyFilters()"
                            [disabled]="activeEnemyFiltersCount === 0">
                            üóëÔ∏è {{ 'clear-filters' | transloco }}
                            <span *ngIf="activeEnemyFiltersCount > 0" class="filter-count">{{ activeEnemyFiltersCount
                                }}</span>
                        </button>
                    </div>
                </div>

                <!-- Enemy filter status info -->
                <div class="filter-status" *ngIf="activeEnemyFiltersCount > 0">
                    <p>
                        {{ 'showing-filtered-results' | transloco }}
                        <strong>{{ filteredEnemies.length }}</strong>
                        {{ 'of' | transloco }}
                        <strong>{{ enemiesList.length }}</strong>
                        {{ 'enemies' | transloco }}
                    </p>
                </div>

                <div class="enemies-grid">
                    @if (enemiesList && enemiesList.length > 0) {
                    @for (enemy of filteredEnemies; track $index) {
                    <div class="enemy-card">
                        <div class="enemy-card-header">
                            <h3 class="enemy-card-title">{{ enemy.name }}</h3>
                            <div class="enemy-card-level">{{ 'level' | transloco }} {{ enemy.level }}</div>
                        </div>

                        <div class="enemy-card-image" [style.backgroundImage]="'url(' + enemy.image_url + ')'">
                            <div class="enemy-card-overlay"></div>
                        </div>

                        <div class="enemy-card-content">
                            <p class="enemy-card-description">{{ enemy.description }}</p>

                            <div class="enemy-card-stats">
                                <div class="stat-item">
                                    <span class="stat-icon">‚ù§Ô∏è</span>
                                    <span class="stat-value">{{ enemy.total_hp || 100 }}</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-icon">‚öîÔ∏è</span>
                                    <span class="stat-value">10</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-icon">üõ°Ô∏è</span>
                                    <span class="stat-value">{{ enemy.defense || 5 }}</span>
                                </div>
                            </div>
                        </div>

                        <div class="enemy-card-actions">
                            <button class="enemy-action-button primary" (click)="addEnemyToBattle(enemy)">
                                {{ 'add-to-battle' | transloco }}
                            </button>
                            <button class="enemy-action-button" (click)="editEnemy(enemy)">
                                {{ 'edit' | transloco }}
                            </button>
                            <button class="enemy-action-button danger" (click)="deleteEnemy(enemy)">
                                {{ 'delete' | transloco }}
                            </button>
                        </div>
                    </div>
                    }
                    } @else {
                    <div class="empty-enemies-list">
                        <div class="empty-icon">üêâ</div>
                        <p>{{ 'no-enemies-available' | transloco }}</p>
                        <button class="create-first-enemy" (click)="openCreateEnemyDialog()">
                            {{ 'create-first-enemy' | transloco }}
                        </button>
                    </div>
                    }
                </div>
            </div>
        </ng-container>

        <!-- NPCs Section - only visible when npcs tab is active -->
        <ng-container *ngIf="currentTab === 'npcs'">
            <div class="npcs-library">
                <div class="library-header">
                    <h2 class="library-title">{{ 'npc-library' | transloco }}</h2>
                    <div class="library-actions">
                        <button class="library-button" (click)="createNPC()">
                            <span class="add-icon">+</span>
                            {{ 'create-npc' | transloco }}
                        </button>
                        <div class="search-container">
                            <input type="text" class="search-input" placeholder="{{ 'search-npcs' | transloco }}"
                                [(ngModel)]="searchTermNPCs">
                        </div>
                    </div>
                </div>

                <div class="enemies-grid">
                    @if (filteredNPCs.length > 0) {
                    @for (npc of filteredNPCs; track npc.id) {
                    <div class="enemy-card">
                        <div class="enemy-card-header">
                            <h3 class="enemy-card-title">{{ npc.name }}</h3>
                        </div>

                        <div class="enemy-card-image" [style.backgroundImage]="'url(' + npc.img_url + ')'">
                            <div class="enemy-card-overlay"></div>
                        </div>

                        <div class="enemy-card-content">
                            <div class="enemy-card-stats">
                                @if (npc.description) {
                                <div class="stat-item">
                                    <span>{{ npc.description }}</span>
                                </div>
                                }
                            </div>
                        </div>

                        <div class="enemy-card-actions">
                            <button class="enemy-action-button" (click)="editNPC(npc)">
                                {{ 'edit' | transloco }}
                            </button>
                            <button class="enemy-action-button danger" (click)="deleteNPC(npc)">
                                {{ 'delete' | transloco }}
                            </button>
                        </div>
                    </div>
                    }
                    } @else {
                    <div class="empty-enemies-list">
                        <div class="empty-icon">üë§</div>
                        <p>{{ 'no-npcs-available' | transloco }}</p>
                        <button class="create-first-enemy" (click)="createNPC()">
                            {{ 'create-first-npc' | transloco }}
                        </button>
                    </div>
                    }
                </div>
            </div>
        </ng-container>

        <!-- Missions Section - only visible when quests tab is active -->
        <ng-container *ngIf="currentTab === 'quests'">
            <div class="missions-section">
                <div class="missions-header">
                    <h2 class="missions-title">{{ 'mission-management' | transloco }}</h2>
                    <div class="missions-actions">
                        <button class="mission-button primary" (click)="openMissionForm()">
                            <span class="add-icon">+</span>
                            {{ 'create-mission' | transloco }}
                        </button>
                        <div class="search-container">
                            <input type="text" class="search-input" placeholder="{{ 'search-missions' | transloco }}"
                                [(ngModel)]="searchTermMissions">
                        </div>
                    </div>
                </div>

                <!-- Missions Grid -->
                <div class="missions-grid">
                    @if (filteredMissions && filteredMissions.length > 0) {
                    @for (mission of filteredMissions; track mission.id) {
                    <div class="mission-card">
                        <div class="mission-card-header">
                            <h3 class="mission-card-title">{{ mission.title }}</h3>
                            <div class="mission-badges">
                                <span class="mission-badge difficulty"
                                    [style.background-color]="getDifficultyColor(mission.difficulty)">
                                    {{ mission.difficulty | transloco }}
                                </span>
                                <span class="mission-badge status"
                                    [style.background-color]="getStatusColor(mission.status)">
                                    {{ mission.status | transloco }}
                                </span>
                            </div>
                        </div>

                        <div class="mission-card-content">
                            <p class="mission-description">{{ mission.description }}</p>

                            <!-- Assignment information -->
                            @if (mission.assigned_to) {
                            <div class="assignment-info">
                                <span class="assignment-label">{{ 'assigned-to' | transloco }}:</span>
                                <span class="assignment-player">{{ getAssignedProfileName(mission.assigned_to) }}</span>
                            </div>
                            }
                        </div>

                        <div class="mission-card-actions">
                            <button class="mission-action-button primary" (click)="editMission(mission)">
                                {{ 'edit' | transloco }}
                            </button>
                            @if (mission.assigned_to) {
                            <button class="mission-action-button secondary" (click)="unassignMission(mission)">
                                {{ 'unassign' | transloco }}
                            </button>
                            } @else {
                            <button class="mission-action-button assign" (click)="openAssignmentModal(mission)">
                                {{ 'assign-to-player' | transloco }}
                            </button>
                            }
                            <button class="mission-action-button danger" (click)="deleteMission(mission)">
                                {{ 'delete' | transloco }}
                            </button>
                        </div>
                    </div>
                    }
                    } @else {
                    <div class="empty-missions-list">
                        <div class="empty-icon">üìã</div>
                        <p>{{ 'no-missions-available' | transloco }}</p>
                        <button class="create-first-mission" (click)="openMissionForm()">
                            {{ 'create-first-mission' | transloco }}
                        </button>
                    </div>
                    }
                </div>

                <!-- Mission Assignment Modal -->
                <div class="mission-form-overlay" *ngIf="showAssignmentModal" (click)="closeAssignmentModal()">
                    <div class="assignment-modal" (click)="$event.stopPropagation()">
                        <div class="assignment-modal-header">
                            <h3>{{ 'assign-mission' | transloco }}</h3>
                            <button class="close-button" (click)="closeAssignmentModal()">√ó</button>
                        </div>

                        <div class="assignment-modal-content">
                            @if (selectedMissionForAssignment) {
                            <div class="mission-info">
                                <h4>{{ selectedMissionForAssignment.title }}</h4>
                                <p>{{ selectedMissionForAssignment.description }}</p>
                            </div>
                            }

                            <div class="profile-selector">
                                <label for="profileSelect">{{ 'select-player' | transloco }}</label>
                                <select id="profileSelect" [(ngModel)]="selectedProfileId" name="profileId"
                                    class="form-select">
                                    <option value="">{{ 'select-player-option' | transloco }}</option>
                                    @for (profile of profilesList; track profile.id) {
                                    <option [value]="profile.id!">
                                        {{ profile.username }} ({{ profile.clase }} - Lvl {{ profile.level }})
                                    </option>
                                    }
                                </select>
                            </div>

                            <div class="assignment-actions">
                                <button type="button" class="form-button secondary" (click)="closeAssignmentModal()">
                                    {{ 'cancel' | transloco }}
                                </button>
                                <button type="button" class="form-button primary" [disabled]="!selectedProfileId"
                                    (click)="assignMissionToProfile()">
                                    {{ 'assign-mission' | transloco }}
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </ng-container>

        <ng-container *ngIf="currentTab === 'users'">
            <div class="users-section">
                <div class="users-header">
                    <h2 class="users-title">{{ 'user-management' | transloco }}</h2>
                    <div class="users-actions">
                        <div class="search-container">
                            <input type="text" class="search-input" placeholder="{{ 'search-users' | transloco }}"
                                [(ngModel)]="searchTermUsers">
                        </div>
                    </div>
                </div>

                <!-- Users Grid -->
                <div class="users-grid">
                    @if (isLoadingUsers) {
                    <div class="loading-users">
                        <mat-spinner diameter="40"></mat-spinner>
                        <p>{{ 'loading-users' | transloco }}</p>
                    </div>
                    } @else if (filteredUsers && filteredUsers.length > 0) {
                    @for (user of filteredUsers; track user.id) {
                    <div class="user-card">
                        <div class="user-card-header">
                            <div class="user-basic-info">
                                <h3 class="user-email">{{ user.email }}</h3>
                            </div>
                            <div class="user-dates">
                                <small class="user-created">{{ 'created' | transloco }}: {{
                                    formatUserDate(user.created_at) }}</small>
                                @if (user.last_sign_in_at) {
                                <small class="user-last-login">{{ 'last-login' | transloco }}: {{
                                    formatUserDate(user.last_sign_in_at) }}</small>
                                }
                            </div>
                        </div>

                        <div class="user-card-content">
                            @if (user.profile) {
                            <!-- User has a profile -->
                            <div class="user-profile">
                                <div class="profile-info">
                                    <div class="profile-avatar"
                                        [style.backgroundImage]="'url(' + user.profile.image_url + ')'">
                                        <div class="profile-level">{{ user.profile.level }}</div>
                                    </div>
                                    <div class="profile-details">
                                        <h4 class="profile-username">{{ user.profile.username }}</h4>
                                        <div class="profile-class">{{ user.profile.clase }} {{ user.profile.power }}
                                        </div>
                                        <div class="profile-stats">
                                            <span class="stat">HP: {{ user.profile.current_hp }}/{{
                                                user.profile.total_hp }}</span>
                                            <span class="stat">ATK: {{ user.profile.attack }}</span>
                                            <span class="stat">DEF: {{ user.profile.defense }}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            } @else {
                            <!-- User doesn't have a profile -->
                            <div class="no-profile">
                                <div class="no-profile-icon">üë§</div>
                                <p class="no-profile-text">{{ 'no-profile-created' | transloco }}</p>
                            </div>
                            }
                        </div>

                        <div class="user-card-actions">
                            @if (user.profile) {
                            <button class="user-action-button primary" (click)="editUserProfile(user)">
                                {{ 'edit-profile' | transloco }}
                            </button>
                            } @else {
                            <button class="user-action-button primary" (click)="openCreateProfileModal(user)">
                                {{ 'create-profile' | transloco }}
                            </button>
                            }
                            <button class="user-action-button danger" (click)="deleteUser(user)">
                                {{ 'delete-user' | transloco }}
                            </button>
                        </div>
                    </div>
                    }
                    } @else {
                    <div class="empty-users-list">
                        <div class="empty-icon">üë•</div>
                        <p>{{ 'no-users-available' | transloco }}</p>
                    </div>
                    }
                </div>

                <!-- Create Profile Modal -->
                <div class="user-form-overlay" *ngIf="showUserProfileModal" (click)="closeUserProfileModal()">
                    <div class="profile-modal" (click)="$event.stopPropagation()">
                        <div class="profile-modal-header">
                            <h3>{{ 'create-profile-for-user' | transloco }}</h3>
                            <button class="close-button" (click)="closeUserProfileModal()">√ó</button>
                        </div>

                        <div class="profile-modal-content">
                            @if (selectedUserForProfile) {
                            <div class="user-info">
                                <h4>{{ selectedUserForProfile.email }}</h4>
                            </div>

                            <form #profileForm="ngForm" (ngSubmit)="createProfileForUser(profileForm.value)">
                                <div class="form-group">
                                    <label for="username">{{ 'username' | transloco }}</label>
                                    <input type="text" id="username" name="username" class="form-input" required
                                        ngModel>
                                </div>

                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="clase">{{ 'class' | transloco }}</label>
                                        <select id="clase" name="clase" class="form-select" required ngModel>
                                            <option value="">{{ 'select-class' | transloco }}</option>
                                            <option value="Guerrero">{{ 'warrior' | transloco }}</option>
                                            <option value="Mago">{{ 'mage' | transloco }}</option>
                                            <option value="Explorador">{{ 'explorer' | transloco }}</option>
                                        </select>
                                    </div>

                                    <div class="form-group">
                                        <label for="power">{{ 'power' | transloco }}</label>
                                        <select id="power" name="power" class="form-select" required ngModel>
                                            <option value="">{{ 'select-power' | transloco }}</option>
                                            <option value="Fuego">{{ 'fire' | transloco }}</option>
                                            <option value="Agua">{{ 'water' | transloco }}</option>
                                            <option value="Tierra">{{ 'earth' | transloco }}</option>
                                            <option value="Aire">{{ 'air' | transloco }}</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="level">{{ 'level' | transloco }}</label>
                                        <input type="number" id="level" name="level" class="form-input" min="1"
                                            max="100" value="1" ngModel>
                                    </div>

                                    <div class="form-group">
                                        <label for="weapon">{{ 'weapon' | transloco }}</label>
                                        <input type="text" id="weapon" name="weapon" class="form-input" ngModel>
                                    </div>
                                </div>

                                <div class="form-actions">
                                    <button type="button" class="form-button secondary"
                                        (click)="closeUserProfileModal()">
                                        {{ 'cancel' | transloco }}
                                    </button>
                                    <button type="submit" class="form-button primary" [disabled]="!profileForm.valid">
                                        {{ 'create-profile' | transloco }}
                                    </button>
                                </div>
                            </form>
                            }
                        </div>
                    </div>
                </div>
            </div>
        </ng-container>

        <!-- Habilities Section - only visible when habilities tab is active -->
        <ng-container *ngIf="currentTab === 'habilities'">
            <div class="habilities-management">
                <div class="habilities-header">
                    <h2 class="habilities-title">{{ 'hability-library' | transloco }}</h2>
                    <div class="habilities-actions">
                        <button class="library-button" (click)="openCreateHabilityDialog()">
                            <span class="add-icon">+</span>
                            {{ 'create-hability' | transloco }}
                        </button>

                        <div class="filter-container">
                            <select class="power-filter" [(ngModel)]="selectedPowerFilter">
                                <option value="">{{ 'all-power-types' | transloco }}</option>
                                <option *ngFor="let powerType of availablePowerTypes" [value]="powerType">
                                    {{ powerType }}
                                </option>
                            </select>
                        </div>

                        <div class="filter-container">
                            <select class="profile-filter" [(ngModel)]="selectedProfileFilter">
                                <option value="">{{ 'all-profiles' | transloco }}</option>
                                <option *ngFor="let profile of profilesList" [value]="profile.id">
                                    {{ profile.username }}
                                </option>
                            </select>
                        </div>

                        <div class="search-container">
                            <input type="text" class="search-input" placeholder="{{ 'search-habilities' | transloco }}"
                                [(ngModel)]="searchTermHabilities">
                        </div>

                        <button class="clear-filters-button" (click)="clearHabilityFilters()"
                            [disabled]="!searchTermHabilities && !selectedPowerFilter && !selectedProfileFilter">
                            üóëÔ∏è {{ 'clear-filters' | transloco }}
                            <span *ngIf="activeFiltersCount > 0" class="filter-count">{{ activeFiltersCount }}</span>
                        </button>
                    </div>
                </div>

                <!-- Filter status info -->
                <div class="filter-status" *ngIf="activeFiltersCount > 0">
                    <p>
                        {{ 'showing-filtered-results' | transloco }}
                        <strong>{{ filteredHabilities.length }}</strong>
                        {{ 'of' | transloco }}
                        <strong>{{ habilitiesList.length }}</strong>
                        {{ 'habilities' | transloco }}
                    </p>
                </div>

                <div class="habilities-grid">
                    @if (isLoadingHabilities) {
                    <div class="habilities-loading-overlay">
                        <div class="loading-content">
                            <div class="loading-spinner"></div>
                            <p class="loading-text">{{ 'loading' | transloco }}...</p>
                        </div>
                    </div>
                    } @else if (habilitiesList && habilitiesList.length > 0) {
                    @for (hability of filteredHabilities; track $index) {
                    <div class="hability-card" [style.background]="getPowerTheme(hability.power).bgColor">
                        <div class="hability-card-header">
                            <div class="hability-header-main">
                                <span class="power-icon">{{ getPowerTheme(hability.power).icon }}</span>
                                <h3 class="hability-card-title">{{ hability.name }}</h3>
                            </div>
                            <div class="hability-card-level">{{ 'level' | transloco }} {{ hability.level }}</div>
                        </div>

                        <div class="hability-card-content">
                            <p class="hability-card-description">{{ hability.description }}</p>

                            <div class="hability-card-stats">
                                <div class="stat-item">
                                    <span class="stat-label">{{ 'class' | transloco }}:</span>
                                    <span class="stat-value">{{ hability.clase }}</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">{{ 'power' | transloco }}:</span>
                                    <span class="stat-value power-value"
                                        [style.color]="getPowerTheme(hability.power).color">
                                        {{ getPowerTheme(hability.power).icon }} {{ hability.power }}
                                    </span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">{{ 'total-uses' | transloco }}:</span>
                                    <span class="stat-value">{{ hability.total_uses }}</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">{{ 'dice' | transloco }}:</span>
                                    <span class="stat-value">{{ hability.dice }}</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">{{ 'scales-with' | transloco }}:</span>
                                    <span class="stat-value">{{ hability.scales_with }}</span>
                                </div>
                            </div>

                            <!-- Associated profiles display -->
                            <div class="associated-profiles" *ngIf="getAssociatedProfileNames(hability.id).length > 0">
                                <div class="associated-profiles-label">
                                    <span class="stat-label">{{ 'associated-profiles' | transloco }}:</span>
                                </div>
                                <div class="profile-tags">
                                    <span class="profile-tag"
                                        *ngFor="let profileName of getAssociatedProfileNames(hability.id)">
                                        {{ profileName }}
                                    </span>
                                </div>
                            </div>
                        </div>

                        <div class="hability-card-actions">
                            <button class="hability-action-button primary" (click)="editHability(hability)">
                                {{ 'edit' | transloco }}
                            </button>
                            <button class="hability-action-button secondary"
                                (click)="openAssociateHabilityModal(hability)">
                                {{ 'associate-to-profile' | transloco }}
                            </button>
                            <button class="hability-action-button danger" (click)="deleteHability(hability)">
                                {{ 'delete' | transloco }}
                            </button>
                        </div>
                    </div>
                    }
                    } @else {
                    <div class="empty-state">
                        <div class="empty-icon">‚ú®</div>
                        <h3>{{ 'no-habilities-available' | transloco }}</h3>
                        <p>{{ 'create-first-hability' | transloco }}</p>
                        <button class="library-button" (click)="openCreateHabilityDialog()">
                            <span class="add-icon">+</span>
                            {{ 'create-hability' | transloco }}
                        </button>
                    </div>
                    }
                </div>

                <!-- Hability Association Modal -->
                <div class="hability-form-overlay" *ngIf="showHabilityAssociationModal"
                    (click)="closeHabilityAssociationModal()">
                    <div class="association-modal" (click)="$event.stopPropagation()">
                        <div class="association-modal-header">
                            <h3>{{ 'associate-hability-to-profiles' | transloco }}</h3>
                            <button class="close-button" (click)="closeHabilityAssociationModal()">√ó</button>
                        </div>

                        <div class="association-modal-content">
                            @if (selectedHabilityForAssociation) {
                            <div class="hability-info">
                                <h4>{{ selectedHabilityForAssociation.name }}</h4>
                                <p>{{ selectedHabilityForAssociation.description }}</p>
                            </div>
                            }

                            <div class="profiles-selector">
                                <label>{{ 'select-profiles' | transloco }}</label>
                                <div class="profiles-checkboxes">
                                    @for (profile of profilesList; track profile.id) {
                                    <div class="profile-checkbox">
                                        <input type="checkbox" [id]="'profile-' + profile.id" [value]="profile.id!"
                                            [checked]="selectedProfilesForAssociation.includes(profile.id!)"
                                            (change)="toggleProfileSelection(profile.id!, $event)">
                                        <label [for]="'profile-' + profile.id">{{ profile.username }}</label>
                                    </div>
                                    }
                                </div>
                            </div>

                            <div class="association-actions">
                                <button type="button" class="form-button secondary"
                                    (click)="closeHabilityAssociationModal()">
                                    {{ 'cancel' | transloco }}
                                </button>
                                <button type="button" class="form-button primary"
                                    (click)="associateHabilityToProfiles()">
                                    {{ 'associate-hability' | transloco }}
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </ng-container>
    </div>

    <div class="dm-footer">
        <app-locale-changer></app-locale-changer>
        <button class="enemy-action-button danger" (click)="signOut()">
            {{ 'sign-out' | transloco }}
        </button>
    </div>
</div>