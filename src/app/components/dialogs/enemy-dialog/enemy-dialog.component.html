<div class="enemy-dialog">
  <div class="dialog-header">
    <h2>{{ isEditing ? ('edit-enemy' | transloco) : ('create-enemy' | transloco) }}</h2>
  </div>

  <form [formGroup]="enemyForm" (ngSubmit)="onSave()" class="enemy-form">
    <div class="form-content">
      <!-- Name field -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>{{ 'enemy-name' | transloco }}</mat-label>
        <input matInput formControlName="name" placeholder="{{ 'enemy-name' | transloco }}">
        <mat-error *ngIf="enemyForm.get('name')?.invalid && enemyForm.get('name')?.touched">
          {{ getErrorMessage('name') }}
        </mat-error>
      </mat-form-field>

      <!-- Description field -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>{{ 'enemy-description' | transloco }}</mat-label>
        <textarea matInput formControlName="description" 
                  placeholder="{{ 'enemy-description' | transloco }}"
                  rows="3"></textarea>
        <mat-error *ngIf="enemyForm.get('description')?.invalid && enemyForm.get('description')?.touched">
          {{ getErrorMessage('description') }}
        </mat-error>
      </mat-form-field>

      <div class="form-row">
        <!-- Level field -->
        <mat-form-field appearance="outline" class="half-width">
          <mat-label>{{ 'level' | transloco }}</mat-label>
          <input matInput type="number" formControlName="level" min="1" max="100">
          <mat-error *ngIf="enemyForm.get('level')?.invalid && enemyForm.get('level')?.touched">
            {{ getErrorMessage('level') }}
          </mat-error>
        </mat-form-field>

        <!-- Defense field -->
        <mat-form-field appearance="outline" class="half-width">
          <mat-label>{{ 'defense' | transloco }}</mat-label>
          <input matInput type="number" formControlName="defense" min="0">
          <mat-error *ngIf="enemyForm.get('defense')?.invalid && enemyForm.get('defense')?.touched">
            {{ getErrorMessage('defense') }}
          </mat-error>
        </mat-form-field>
      </div>

      <div class="form-row">
        <!-- Total HP field -->
        <mat-form-field appearance="outline" class="half-width">
          <mat-label>{{ 'total-hp' | transloco }}</mat-label>
          <input matInput type="number" formControlName="total_hp" min="1">
          <mat-error *ngIf="enemyForm.get('total_hp')?.invalid && enemyForm.get('total_hp')?.touched">
            {{ getErrorMessage('total_hp') }}
          </mat-error>
        </mat-form-field>

        <!-- Current HP field -->
        <mat-form-field appearance="outline" class="half-width">
          <mat-label>{{ 'current-hp' | transloco }}</mat-label>
          <input matInput type="number" formControlName="current_hp" min="0">
          <mat-error *ngIf="enemyForm.get('current_hp')?.invalid && enemyForm.get('current_hp')?.touched">
            {{ getErrorMessage('current_hp') }}
          </mat-error>
        </mat-form-field>
      </div>

      <!-- Boss checkbox -->
      <div class="checkbox-container">
        <mat-checkbox formControlName="is_boss">
          {{ 'is-boss-enemy' | transloco }}
        </mat-checkbox>
      </div>

      <!-- Image URL field -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>{{ 'image-url' | transloco }}</mat-label>
        <input matInput formControlName="image_url" placeholder="{{ 'image-url-placeholder' | transloco }}">
        <mat-error *ngIf="enemyForm.get('image_url')?.invalid && enemyForm.get('image_url')?.touched">
          {{ getErrorMessage('image_url') }}
        </mat-error>
      </mat-form-field>

      <!-- Image preview -->
      <div class="image-preview" *ngIf="enemyForm.get('image_url')?.value">
        <img [src]="enemyForm.get('image_url')?.value" 
             [alt]="enemyForm.get('name')?.value || 'Enemy preview'"
             (error)="onImageError($event)"
             (load)="onImageLoad($event)">
      </div>

      <!-- Default image options -->
      <div class="default-images">
        <h4>{{ 'select-default-image' | transloco }}:</h4>
        <div class="image-grid">
          <div *ngFor="let imageUrl of defaultEnemyImages" 
               class="image-option"
               [class.selected]="enemyForm.get('image_url')?.value === imageUrl"
               (click)="selectDefaultImage(imageUrl)">
            <img [src]="imageUrl" [alt]="'Default enemy image'">
          </div>
        </div>
      </div>
    </div>

    <div class="dialog-actions">
      <button type="button" mat-button (click)="onCancel()" class="cancel-button">
        {{ 'close' | transloco }}
      </button>
      <button type="submit" mat-raised-button color="primary" [disabled]="!enemyForm.valid" class="save-button">
        {{ isEditing ? ('update-enemy' | transloco) : ('create-enemy' | transloco) }}
      </button>
    </div>
  </form>
</div>
